<!-- app/templates/contact.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>お問い合わせ | Hatano Lab</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // --- 確認・クリア機能 ---
    function confirmSubmit() {
      return confirm("入力内容を送信します。よろしいですか？");
    }
    function clearForm() {
      if (confirm("入力内容をすべてクリアしますか？")) {
        document.getElementById("contactForm").reset();
        document.getElementById("suggestList").innerHTML = "";
      }
    }

    // --- 郵便番号入力時のサジェスト ---
    async function suggestAddress() {
      const postal = document.querySelector('input[name="postal"]').value.replace(/[^0-9]/g, "");
      const suggestBox = document.getElementById("suggestList");
      suggestBox.innerHTML = "";

      if (postal.length < 3) return;

      try {
        const response = await fetch(`https://zipcloud.ibsnet.co.jp/api/search?zipcode=${postal}`);
        const data = await response.json();

        if (data.results) {
          data.results.forEach(result => {
            const option = document.createElement("div");
            option.className = "cursor-pointer px-2 py-1 hover:bg-blue-100";
            option.textContent = `${result.zipcode}（${result.address1}${result.address2}${result.address3}）`;
            option.onclick = () => selectAddress(result);
            suggestBox.appendChild(option);
          });
        }
      } catch (e) {
        console.error("住所候補取得エラー:", e);
      }
    }

    // --- 候補クリック時に都道府県・市区町村を設定 ---
    function selectAddress(result) {
      document.querySelector('input[name="postal"]').value = result.zipcode;
      document.getElementById("suggestList").innerHTML = "";

      const prefSelect = document.getElementById("prefectureSelect");
      for (const option of prefSelect.options) {
        if (option.value === result.address1) {
          option.selected = true;
          break;
        }
      }

      const citySelect = document.getElementById("citySelect");
      citySelect.innerHTML = "";
      const option = document.createElement("option");
      option.value = result.address2;
      option.textContent = result.address2;
      option.selected = true;
      citySelect.appendChild(option);

      document.querySelector('input[name="address"]').value = result.address3 || "";
    }

    // --- 都道府県リスト初期化 ---
    document.addEventListener("DOMContentLoaded", () => {
      const prefs = [
        "北海道","青森県","岩手県","宮城県","秋田県","山形県","福島県",
        "茨城県","栃木県","群馬県","埼玉県","千葉県","東京都","神奈川県",
        "新潟県","富山県","石川県","福井県","山梨県","長野県","岐阜県",
        "静岡県","愛知県","三重県","滋賀県","京都府","大阪府","兵庫県",
        "奈良県","和歌山県","鳥取県","島根県","岡山県","広島県","山口県",
        "徳島県","香川県","愛媛県","高知県","福岡県","佐賀県","長崎県",
        "熊本県","大分県","宮崎県","鹿児島県","沖縄県"
      ];
      const select = document.getElementById("prefectureSelect");
      prefs.forEach(p => {
        const opt = document.createElement("option");
        opt.value = p;
        opt.textContent = p;
        select.appendChild(opt);
      });
    });
  </script>
</head>

<body class="bg-gray-50 min-h-screen flex flex-col items-center">
  <header class="w-full bg-blue-600 text-white py-4 flex justify-center space-x-8">
    <a href="{{ url_for('top') }}" class="hover:underline">トップ画面</a>
    <a href="{{ url_for('contact') }}" class="hover:underline">お問い合わせ</a>
  </header>

  <main class="flex-1 w-full max-w-3xl mt-10 bg-white shadow-md rounded-lg p-8 relative">
    <h1 class="text-2xl font-bold text-blue-700 mb-6 text-center">お問い合わせフォーム</h1>

    <form id="contactForm" action="{{ url_for('contact_submit') }}" method="POST" onsubmit="return confirmSubmit()" class="space-y-6">
      <!-- 区分 -->
      <div>
        <label class="block text-gray-700 font-medium mb-1">区分</label>
        <select name="category" required class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-400">
          <option value="">選択してください</option>
          <option value="ご意見">ご意見</option>
          <option value="ご質問">ご質問</option>
          <option value="その他">その他</option>
        </select>
      </div>

      <!-- お問い合わせ内容 -->
      <div>
        <label class="block text-gray-700 font-medium mb-1">お問い合わせ内容</label>
        <textarea name="contact_content" rows="5" required class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-400"></textarea>
      </div>

      <!-- お名前 -->
      <div>
        <label class="block text-gray-700 font-medium mb-1">お名前</label>
        <input type="text" name="contact_name" required class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-400">
      </div>

      <!-- フリガナ -->
      <div>
        <label class="block text-gray-700 font-medium mb-1">フリガナ</label>
        <input type="text" name="contact_furigana" required class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-400">
      </div>

      <!-- メール -->
      <div>
        <label class="block text-gray-700 font-medium mb-1">メールアドレス</label>
        <input type="email" name="contact_email" required class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-400">
      </div>
      <div>
        <label class="block text-gray-700 font-medium mb-1">メールアドレス（確認用）</label>
        <input type="email" name="email_confirm" required class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-400">
      </div>

      <!-- 年齢 -->
      <div>
        <label class="block text-gray-700 font-medium mb-1">年齢</label>
        <input type="number" name="age" min="1" max="120" class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-400">
      </div>

      <!-- 郵便番号 -->
      <div class="relative">
        <label class="block text-gray-700 font-medium mb-1">郵便番号</label>
        <input type="text" name="postal" placeholder="例：1234567" onkeyup="suggestAddress()"
               class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-400" autocomplete="off">
        <div id="suggestList" class="absolute z-10 bg-white border rounded shadow w-full max-h-40 overflow-auto"></div>
      </div>

      <!-- 都道府県 -->
      <div>
        <label class="block text-gray-700 font-medium mb-1">都道府県</label>
        <select name="prefecture" required id="prefectureSelect" class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-400">
          <option value="">選択してください</option>
        </select>
      </div>

      <!-- 市区町村 -->
      <div>
        <label class="block text-gray-700 font-medium mb-1">市区町村</label>
        <select name="city" required id="citySelect" class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-400">
          <option value="">選択してください</option>
        </select>
      </div>

      <!-- 番地 -->
      <div>
        <label class="block text-gray-700 font-medium mb-1">番地・建物名</label>
        <input type="text" name="address" class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-400">
      </div>

      <!-- 電話番号 -->
      <div>
        <label class="block text-gray-700 font-medium mb-1">電話番号</label>
        <input type="tel" name="phone" pattern="\d{2,4}-?\d{2,4}-?\d{3,4}" placeholder="例：090-1234-5678"
               class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-400">
      </div>

      <!-- ボタン -->
      <div class="flex justify-end space-x-4 mt-6">
        <button type="button" onclick="clearForm()" class="px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400 transition">入力内容クリア</button>
        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">送信</button>
      </div>
    </form>
  </main>

  <footer class="w-full text-center text-gray-500 py-4 mt-10">
    &copy; 2025 Hatano Lab
  </footer>
</body>
</html>
